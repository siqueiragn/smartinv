function calculaLarguras(a){var b;b="undefined"==typeof tabela?a:tabela[a];var c=b.colunas,d=getLargura(),e=new Array,f=0;for(var g in c)40==c[g].width?d-=40:e[f++]=c[g];if(0==e.length)return!0;var h=parseInt(d/e.length)-10;for(var g in e)e[g].width=h}function getIndiceTabela(a){return btId=a.currentTarget.id,bt=btId.split("_"),bt[1]}function getIdTabela(a){return"#tabelaDados"+tabela[a].idTabela}function dadosSelecionadosUrl(a){return selecionados=$(".trSelected",a),url="",$.each(selecionados,function(a){url+="&dado["+a+"]="+selecionados[a].id.replace("row","")}),url}function gerarGrafico(a){if(url="",i=getIndiceTabela(a),1==tabela[i].gerarGraficoSemConfirmacao)dadosSelecionados="";else{id=$(getIdTabela(i)).jqGrid("getGridParam","selarrrow");var b=0;if($.each(id,function(a){url+="&dado["+b+"]="+id[b],b++}),""==url)return alert("Você deve escolher pelo menos uma linha na tabela!"),!1}if(tabela[i].graficoDinamico){if(dadosSelecionados=dadosSelecionadosUrl(a),0==dadosSelecionados)return alert("Você deve escolher pelo menos uma linha na tabela!"),!1}else dadosSelecionados="";return requisicao=$.ajax({url:tabela[i].acaoGerarGrafico+url,type:"get",dataType:"html"}),requisicao.done(function(a){$("#graficoGerado").html(a)}),requisicao.fail(function(a,b){$("#graficoGerado").html('<p class="erro">Problemas ao carregar o site. Tente novamente mais tarde!</p>')}),$("#graficoGerado").dialog("open"),!0}function exportarPDF(a){i=getIndiceTabela(a);var b=tabela[i].acaoExportarPDF,c=tabela[i].titulo;return"padrao"==b?(d=$(getIdTabela(i)).jqGrid("jqGridExport",{exptype:"jsonstring"}),C=$.parseJSON(d),location.href="exportarPDF?url="+encodeURIComponent(C.grid.url)+"&postData="+encodeURIComponent(JSON.stringify(C.grid.postData))+"&colModel="+encodeURIComponent(JSON.stringify(C.grid.colModel))+"&titulo="+c,!1):void(location.href=b)}function gerarCSV(a){i=getIndiceTabela(a);var b=tabela[i].acaoGerarCSV,c=tabela[i].titulo;return"padrao"==b?(d=$(getIdTabela(i)).jqGrid("jqGridExport",{exptype:"jsonstring"}),C=$.parseJSON(d),location.href="exportarCSV?url="+encodeURIComponent(C.grid.url)+"&postData="+encodeURIComponent(JSON.stringify(C.grid.postData))+"&colModel="+encodeURIComponent(JSON.stringify(C.grid.colModel))+"&titulo="+c,!1):void $(getIdTabela(i)).jqGrid("excelExport",{tag:"csv",url:tabela[i].acaoGerarCSV})}function imprimir(a){i=getIndiceTabela(a),window.open(tabela[i].acaoImprimir,"impressao","width=800,height=500,scroll=yes")}function editar(a){i=getIndiceTabela(a);var b=$(getIdTabela(i)).jqGrid("getGridParam","selrow");b?location.href=tabela[i].acaoEditar+"?id="+b:alert("Por favor selecione um dado!")}function deletar(a){i=getIndiceTabela(a);var b=$(getIdTabela(i)).jqGrid("getGridParam","selrow");if(b){if(!window.confirm("Tem certeza que deseja apagar o arquivo? \n Essa ação é irreversível."))return!1;location.href=tabela[i].acaoDeletar+"?id="+b}else alert("Por favor selecione um dado!")}function capturaAltura(a){return 1==tabela.length?alturaPagina():void tabela[a].altura}$(document).ready(function(){largura=parseInt($("body").css("width"))-5;for(tab in tabela)tabelaPaginacao="#tabelaPaginacao"+tabela[tab].idTabela,idTabela=getIdTabela(tab),calculaLarguras(tab),objeto={url:tabela[tab].dados,datatype:"json",styleUI:"Bootstrap",mtype:"POST",colNames:tabela[tab].labelsColunas,colModel:tabela[tab].colunas,multiselect:tabela[tab].selecaoSimples,usepager:!0,sortable:tabela[tab].ordenavel,useRp:!0,caption:tabela[tab].titulo,pager:tabelaPaginacao,rowNum:300,width:largura,height:capturaAltura(tab),rowList:[80,160,200],viewrecords:!0,showTableToggleBtn:!0},$(".ui-jqgrid .ui-jqgrid-bdiv").css("overflow","auto"),$(idTabela).jqGrid(objeto),$(idTabela).jqGrid("gridResize",{minWidth:500,maxWidth:largura,minHeight:200}),$(idTabela).jqGrid("setFrozenColumns"),navegacao=$("#tabelaDados"+tabela[tab].idTabela).navGrid(tabelaPaginacao,{search:!0,edit:!1,add:!1,del:!1,refresh:!1},{caption:"Buscar"},{},{},{closeOnEscape:!0,multipleSearch:!0,closeAfterSearch:!0}),$("#tabelaDados"+tabela[tab].idTabela).navSeparatorAdd(tabelaPaginacao,{sepclass:"ui-separator",sepcontent:""}),tabela[tab].filtrar&&$("#tabelaDados"+tabela[tab].idTabela).jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!1}),tabela[tab].botaoEditar&&navegacao.navButtonAdd(tabelaPaginacao,{caption:"Editar",buttonicon:"ui-icon-pencil",onClickButton:editar,position:"last",title:"Editar informação",cursor:"hand",id:"btEditar_"+tab}),tabela[tab].botaoDeletar&&navegacao.navButtonAdd(tabelaPaginacao,{caption:"Deletar",buttonicon:"ui-icon-trash",onClickButton:deletar,position:"last",title:"Deletar informação",cursor:"hand",id:"btDeletar_"+tab}),tabela[tab].botaoImprimir&&navegacao.navButtonAdd(tabelaPaginacao,{caption:"Imprimir",buttonicon:"ui-icon-print",onClickButton:imprimir,position:"last",title:"Imprimir",cursor:"hand",id:"btPrint_"+tab}),tabela[tab].botaoGerarGrafico&&navegacao.navButtonAdd(tabelaPaginacao,{caption:"Gráfico",buttonicon:"gerarGraficoIco",onClickButton:gerarGrafico,title:"Gerar gráfico",position:"last",cursor:"hand",id:"btGrafico_"+tab}),$("#tabelaDados"+tabela[tab].idTabela).navSeparatorAdd("#tabelaPaginacao"+tabela[tab].idTabela,{sepclass:"ui-separator",sepcontent:""}),tabela[tab].botaoGerarCSV&&navegacao.navButtonAdd(tabelaPaginacao,{caption:"CSV",buttonicon:"gerarCSVIco",onClickButton:gerarCSV,position:"last",title:"Gerar CSV",cursor:"hand",id:"btGerarCsv_"+tab}),tabela[tab].botaoExportarPDF&&navegacao.navButtonAdd(tabelaPaginacao,{caption:"PDF",buttonicon:"exportarPDFIco",onClickButton:exportarPDF,position:"last",title:"Exportar PDF",cursor:"hand",id:"btExportar_"+tab});$("#graficoGerado").dialog({autoOpen:!1,width:600,height:510,modal:!0})});
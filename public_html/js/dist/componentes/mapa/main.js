function camada(a){this.tipo=a,this.alteraCorBorda=function(){1==this.tipo},this.alteraCorPreenchimento=function(){},this.alteraTransparencia=function(){}}function itemSelect(a,b){this.value=a,this.label=b,this.subArvore=new Array}function Caminho(){this.imagens="imagens/",this.KML="/dados_geograficos/",this.base="",this.executor=!1,this.getExecutor=function(){return this.base+this.executor},this.getImagem=function(){return this.base+this.imagens}}function estiloCluster(a){var b={low:"rgb(181, 226, 140)",middle:"rgb(241, 211, 87)",high:"rgb(253, 156, 115)"},c=new OpenLayers.Rule({filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"count",value:1}),symbolizer:{externalGraphic:a[0],fillColor:b.low,fillOpacity:.9,strokeColor:b.low,strokeOpacity:.5,strokeWidth:12,pointRadius:10,label:"${count}",labelOutlineWidth:1,fontColor:"#000000",fontSize:"9px",fontWeight:"bold"}}),d=new OpenLayers.Rule({filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN,property:"count",lowerBoundary:2,upperBoundary:16}),symbolizer:{externalGraphic:a[1],fillColor:b.low,fillOpacity:.9,strokeColor:b.low,strokeOpacity:.5,strokeWidth:12,pointRadius:10,label:"${count}",labelOutlineWidth:1,fontColor:"#000000",fontSize:"9px",fontWeight:"bold"}}),e=new OpenLayers.Rule({filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN,property:"count",lowerBoundary:15,upperBoundary:50}),symbolizer:{externalGraphic:a[2],fillColor:b.middle,fillOpacity:.9,strokeColor:b.middle,strokeOpacity:.5,strokeWidth:12,pointRadius:15,label:"${count}",labelOutlineWidth:1,fontColor:"#000000",fontWeight:"bold",fontSize:"9px"}}),f=new OpenLayers.Rule({filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN,property:"count",value:50}),symbolizer:{externalGraphic:a[3],fillColor:b.high,fillOpacity:.9,strokeColor:b.high,strokeOpacity:.5,strokeWidth:12,pointRadius:20,label:"${count}",labelOutlineWidth:1,fontColor:"#000000",fontSize:"9px",fontWeight:"bold"}}),g=new OpenLayers.Style(null,{rules:[c,d,e,f]});return g}function ClusterBuilder(){this.geraLegenda=function(a,b){b=b.substring(0,b.length-8),b+='<sub><a href="#" id="maisCluster'+id+'" class="maisCluster">[-] Agrupamento</a></sub></label>',b+=' <ul class="clusterOption" id="clusterOption'+id+'"> ',b+='   <li> <label class="makeCluster">',b+='     <input type="checkbox"  name="cluster'+id+'" ',b+='              id="makeCluster'+id+'" />Criar agrupamento</label><ul class="legendaCluster">';var c=20;for(var d in itemLegenda.geradorIcone)b+='<li> <img src="'+itemLegenda.geradorIcone[d]+'" width="'+c+'" height="'+c+'"/>  </li>',c+=3;b+='</ul>  <div style="clear:both"></div>',b+=' </li> <li class="restricoesCluster" id="restricoesCluster'+id+'">',b+=itemLegenda.ingles?'   <label class="camposRestricao"> Dimension':'   <label class="camposRestricao"> Dimensão',b+='     <select name="dimension'+id+'" id="dimension'+id+'">',b+='               <option value="none">Nenhuma</option>';for(var d in dim)b+='<option value="'+d+'">'+dim[d].label+"</option>";b+="           </select> </label>",b+='  <label class="camposRestricao">Regra',b+='     <select name="restricao'+id+'" id="restricao'+id+'">',b+='             <option value="none">Nenhuma</option>',b+="     </select> </label>",b+=' <p style="margin-top: 12px; text-indent: 2px;">',b+='<a href="" title="Adicionar restrição" id="adicionarRestricao'+id+'" > E </a></p>',b+='<label class="somenteUmGrupo"> <input type="checkbox" id="somenteUmGrupo'+id+'" value="true"/> Apenas um grupo</label>',b+=itemLegenda.ingles?'<label class="campoRestricaoSlider" id="campoRestricaoSlider'+id+'">Size cluster:':'<label class="campoRestricaoSlider" id="campoRestricaoSlider'+id+'">Tamanho agrupamento:',b+='<input type="text" id="valorSliderCluster'+id+'" />',b+='<div id="sliderCluster'+id+'"></div></label>',2==experimento&&(b+='<div class="selecionaAno"> <input type="text" id="anoMinimo'+id+'" class="anoMinimo"/>',b+='<input type="text" id="anoMaximo'+id+'" class="anoMaximo"/>',b+='<div id="sliderYearRange'+id+'"></div></div>'),b+='<p class="duplicarCluster">',b+='        <a href="" id="duplicarCluster'+id+'" title="Duplicar plano de informação"> [+] Duplicar</a></p>',b+='</li></ul><div style="clear:both"></div>'},this.geraAcao=function(a){a.adicionaEventoClick(a.camadas[id]);var b=new CamadaCluster(id,a);b.features=a.camadas[id].features,b.styles=a.camadas[id].styleMap,a.camadas[id]=b,b.itemLegenda=itemLegenda,itemLegenda.maisCluster=!1,itemLegenda.checked||that.camadas[id].setVisibility(!1),$("#restricoesCluster"+id).hide(),$("#valorSliderCluster"+id).val(35),$("#sliderCluster"+id).slider({value:35,min:0,max:100,step:5,slide:function(a,b){$("#valorSliderCluster"+id).val(b.value)},stop:function(a,c){b.trocaTamanho(c.value)}}),2==experimento&&($("#sliderYearRange"+id).slider({range:!0,min:1980,max:2014,values:[1980,2014],slide:function(a,b){$("#anoMinimo"+id).val(b.values[0]),$("#anoMaximo"+id).val(b.values[1])},stop:function(a,c){var d={dimensao:"tempo",regra:"ano_numero",valor:[c.values[0],c.values[1]]};b.adicionaRegra(d),$.ajax({url:itemLegenda.fonteDeDados,type:"POST",data:"restricao="+$.toJSON(b.enviaRegras()),dataType:"json",success:function(a){b.adicionaCamadaComRegra(a)}}),b.addTempo(c.values)}}),$("#anoMinimo"+id).val($("#sliderYearRange"+id).slider("values",0)),$("#anoMaximo"+id).val($("#sliderYearRange"+id).slider("values",1))),$("#maisCluster"+id).click(function(){return itemLegenda.maisCluster?($("#clusterOption"+id).show("fast"),$("#maisCluster"+id).html("[-] Agrupamento"),itemLegenda.maisCluster=!1):($("#clusterOption"+id).hide("fast"),$("#maisCluster"+id).html("[+] Agrupamento"),itemLegenda.maisCluster=!0),!1}),$("#makeCluster"+id).click(function(){var a=(new Date).getTime();b.makeCluster(id);var c=(new Date).getTime(),d=new Date(c-a);console.log("t1 = "+a+" t2 "+c+"Total de "+d.getSeconds())}),$("#dimension"+id).change(function(){if("none"!==$(this).val()){var a=dim[$(this).val()].values;$("#restricao"+id).html('<option value="none">Selecione</option>');for(var b in a)$("#restricao"+id).append('<option value="'+b+'">'+a[b]+"</option>")}else $("#restricao"+id).html('<option value="none">Nenhuma</option>')}),$("#restricao"+id).change(function(){if("none"==$(this).val()){var a={dimensao:$("#dimension"+id).val()};b.removeRegra(a),$.ajax({url:itemLegenda.fonteDeDados,type:"POST",data:"restricao="+$.toJSON(b.enviaRegras()),dataType:"json",success:function(a){b.adicionaCamadaComRegra(a)}})}else if("passa"!==$(this).val()){var a={dimensao:$("#dimension"+id).val(),regra:$(this).val()};b.adicionaRegra(a),$.ajax({url:itemLegenda.fonteDeDados,type:"POST",data:"restricao="+$.toJSON(b.enviaRegras()),dataType:"json",success:function(a){b.adicionaCamadaComRegra(a)}})}else alert("Sem classificação significativa para esses dados! Necessário dados mais confiaveis ou escala diferente!")}),$("#duplicarCluster"+id).click(function(){return b.duplicaCamada(itemLegenda),!1}),$("#adicionarRestricao"+id).click(function(){return faltaImplementar(),!1}),$("#somenteUmGrupo"+id).click(function(){if($("#somenteUmGrupo"+id).is(":checked"))b.trocaTamanho(1e5),$("#campoRestricaoSlider"+id).hide("puff");else{var a=$("#valorSliderCluster"+id).val();b.trocaTamanho(a),$("#campoRestricaoSlider"+id).show("puff")}}),2==itemLegenda.estadoCluster&&$("#maisCluster"+id).trigger("click")}}function HeatLayerLegend(a){var b,c,d='<a href="#" id="btnInfo'+a.idCamada+'">[show]</a><div id="info'+a.idCamada+'">Legenda layer:';d+='<ul class="legendaInterna">';for(var e in a.info)b=a.info[e],c='<span class="advancedData"></span>',d+='<li><span class="icone" style="background-color:'+b.cor+'"></span>'+b.nome+btMaisInfo(a,e)+"</li>";return d+="</ul></div>"}function executeCanvas(){$(".canvasLegenda").each(function(a,b){var c=$(b).data("data-camada-pattern");console.log(c),makePattern("#66666",c,b)})}function HeatLayerActions(a){$("#info"+a.idCamada).hide(),$("#btnInfo"+a.idCamada).click(function(){$("#info"+a.idCamada).toggle()}),$(".subItemData").click(function(a){$(a.currentTarget).data("id");console.log(estatistica);for(var b in legenda3)console.log(legenda3[b].nome+" = "+estatistica.esfOuUBS[legenda3[b].cor])})}function getCor(a,b){for(var c in b)if(parseFloat(b[c].minimo)<=a&&parseFloat(b[c].maximo)>=a)return b[c].cor;return makePattern("#666","linear")}function armazenaEstatistica(a,b){estatistica[a]||(estatistica[a]=new Object),estatistica[a][b]?estatistica[a][b]++:estatistica[a][b]=1}function btMaisInfo(a,b){var c='<a href="#id=" data-id="'+a.info[b].cor+'" data-layer-data="'+a.vetorDataName+'" class="subItemData" title="Mais informações">[+]</a>';return c}function ItemLegenda(a,b){return this.nome=a,this.icone="/media/mapas/linha.png",this.nomeIcone="suino.png",this.geradorIcone=!1,this.cluster=!1,this.subItem=!1,this.style=!1,this.idCamada=b,this.checked=!0,this.dim=new Array,this.click=!1,this.ingles=!1,this.fonteDeDados="",this.cor="",this.grupo=!1,this.info=!1,this.vetorDataName="",this.setCor=function(a){this.cor="background-color:"+a+";"},"undefined"==typeof ItemLegenda.i&&(ItemLegenda.i=0),++ItemLegenda.i}function eventosLegenda(){$("#sortable").sortable({revert:!0}),$("#draggable").draggable({connectToSortable:"#sortable",helper:"clone",revert:"invalid"}),$("ul, li").disableSelection()}function makeAutoPattern(a,b){for(var c in b)if(parseFloat(b[c].minimo)<=a&&parseFloat(b[c].maximo)>=a)return makePattern(b[c].cor,b[c].pattern);return makePattern("#666666","solid")}function makePattern(a,b){if(isNull(arguments[2]))var c=document.createElement("canvas");else var c=arguments[2];var d=c.getContext("2d"),e=new Object;return e.linear=function(){c.width=6,c.height=6,d.fillStyle=a;for(var b=0;b<6;++b)d.fillRect(b,b,1,1);return d.createPattern(c,"repeat")},e.linear2=function(){c.width=6,c.height=6,d.fillStyle=a;for(var b=0;b<6;++b)d.fillRect(b,b,2,2);return d.createPattern(c,"repeat")},e.verticalLinear=function(){c.width=6,c.height=1,d.fillStyle=a;for(var b=0;b<6;++b)d.fillRect(1,0,1,1);return d.createPattern(c,"repeat")},e.dashed=function(){c.width=6,c.height=6,d.fillStyle=a;for(var b=0;b<6;++b)d.fillRect(b,b,4,1);return d.createPattern(c,"repeat")},e.solid=function(){return c.height=6,c.width=6,d.fillStyle=a,d.fillRect(6,6,6,6),d.createPattern(c,"repeat")},isNull(e[b])?e.solid():(console.log("oiiii"),e[b]())}function tamanhoMapa(){var a=$("body").height()-51;$("#"+this.idMapa).css("height",a),$("#principal").css("height",a)}function Mapa(a){this.legenda=new Array,this.caminho=new Caminho,this.camadas=new Array,this.features=new Array,this.styles=new Array,this.id=0,this.popUp=!1,this.idMapa=a,this.zoom=12,this.x=-5804847.164511,this.y=-3541988.011926,this.setMapa=function(a){this.map=a},this.baseUrl="",this.googleMap=function(a,b){var c=new google.maps.Map(document.getElementById(this.idMapa+"_gmap"),{disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,mapTypeId:google.maps.MapTypeId.SATELLITE});a.on("change:center",function(){var b=ol.proj.transform(a.getCenter(),"EPSG:3857","EPSG:4326");c.setCenter(new google.maps.LatLng(b[1],b[0]))}),a.on("change:resolution",function(){c.setZoom(a.getZoom())}),b.parentNode.removeChild(b),c.controls[google.maps.ControlPosition.TOP_LEFT].push(b)},this.iniciaMapa=function(){tamanhoMapa();var a=new ol.View({maxZoom:21,projection:ol.proj.get("EPSG:3857")}),b=document.getElementById(this.idMapa+"_ol");this.map=new ol.Map({interactions:ol.interaction.defaults({altShiftDragRotate:!1,dragPan:!1,rotate:!1}).extend([new ol.interaction.DragPan({kinetic:null})]),controls:ol.control.defaults({attributionOptions:{collapsible:!1}}).extend([new ol.control.FullScreen,new ol.control.ScaleLine]),target:b,view:a}),$("#"+this.idMapa+"_gmap").hide(),a.setCenter([this.x,this.y]),a.setZoom(this.zoom)},this.getDivMapa=function(){return"#"+this.idMapa+"_ol"},this.setBaseUrl=function(a){this.baseUrl=a},this.adicionaCamada=function(a){return this.map.addLayer(a),this.id++,this.camadas[this.id]=a,this.id},this.adicionaItemLegenda=function(a){this.legenda.push(a);var b=this,c=a.idCamada,d=(a.dim,a.icone);a.cluster?classe="legendaComCluster":classe="legendaNormal";var e='<li id="ordem'+c+'" class="'+classe+'"><div> <span class="ui-icon ui-icon-arrowthick-2-n-s"></span> <label>';e+=' <input type="checkbox" id="layer'+c+'" class="mapOverlays"',a.checked?e+=' checked="checked" ':b.camadas[c].setVisible(!1),e+=' /> <span id="icone'+c+'" class="icone" ',e+='style="background-image:url('+d+"); "+a.cor+'"> </span>',e+=a.nome+" </label>",a.cluster&&(e+=ClusterFactory.geraLegenda(this,e)),a.info&&(e+=HeatLayerLegend(a)),e+="</div></li>",$("#legendaMapa .raiz").prepend(e),executeCanvas(),$("#layer"+c).click(function(){$("#layer"+c).is(":checked")?b.camadas[c].setVisible(!0):b.camadas[c].setVisible(!1)}),"linha.png"===a.icone&&$("#icone"+c).css("backgroundColor","#f00"),a.cluster&&ClusterFactory().geraAcoes(this),a.info&&HeatLayerActions(a)},this.changeLayer=function(a,b){},this.geraCamadaPontoJson=function(a,b){var c=new ol.Layer.Vector("Features",{protocol:new OpenLayers.Protocol.HTTP({url:a,format:new OpenLayers.Format.GeoJSON}),styleMap:new OpenLayers.StyleMap({externalGraphic:b,graphicWidth:25,graphicHeight:25,fillOpacity:1}),renderers:["Canvas","SVG"],strategies:[new OpenLayers.Strategy.Fixed]});return c},this.adicionaCamadaPontoJson=function(a,b){var c=this.geraCamadaPontoJson(a,b);return this.adicionaCamada(c)},this.adicionaCamadaMapServer=function(a,b){var c=new ol.layer.Image({showMenu:!0,source:new ol.source.ImageWMS({url:"http://localhost/cgi-bin/mapserv?",params:{LAYERS:a,mode:"map",map:b,TRANSPARENT:"true",FORMAT:"image/png"},projection:ol.proj.get("EPSG:3857"),serverType:"mapserver"}),extent:[-5689990,-358e4,-568e4,-349e4]});return this.adicionaCamada(c)},this.adicionaCamadaKML=function(a){var b=this.caminho.KML+a+".kml",c=new ol.layer.Vector("KML",{projection:new ol.Projection("EPSG:4326"),strategies:[new ol.Strategy.Fixed],protocol:new ol.Protocol.HTTP({url:b,format:new ol.Format.KML({extractStyles:!1,extractAttributes:!1})})});return this.adicionaCamada(c)},this.adicionaCamadaPonto=function(a){var b=new ol.layer.Vector(a,{renderers:["Canvas","SVG"]});return this.adicionaCamada(b)},this.adicionaPontoEmCamada=function(a,b,c){var d=new ol.geometry.Point(b,c),e=new ol.feature.Vector(d);this.camadas[a].push([e])},this.adicionaCamadaGeoJson=function(a,b,c){var d=this.baseUrl+"/"+a,e=new ol.layer.Vector({title:"added Layer",source:new ol.source.Vector({format:new ol.format.GeoJSON,url:d}),style:c});return this.adicionaCamada(e)}}function PopUp(a){function b(a){var b='    <div id="'+a+'" class="ol-popup">        <a href="#" id="'+a+'-closer" class="ol-popup-closer"></a>        <div id="'+a+'-content"></div>    </div>';return b}this.id=a,this.elemento=null,this.mapa=null,that=this,this.make=function(){isNull(this.mapa)&&console.log("[anta] - definir o mapa antes"),$(this.mapa.getDivMapa()).append(b(this.id)),this.container=document.getElementById(this.id),this.content=document.getElementById(this.id+"-content"),this.closer=document.getElementById(this.id+"-closer"),this.overlay=new ol.Overlay({element:this.container}),this.closer.onclick=function(){return that.overlay.setPosition(void 0),that.closer.blur(),!1},this.mapa.map.addOverlay(this.overlay)},this.setConteudo=function(b){$("#"+a+"-content").html(b)},this.addEvento=function(a){map=this.mapa.map,this.mapa.map.on("click",function(b){var c=b.coordinate;that.displayFeatureInfo(b.pixel,c,a),that.overlay.setPosition(c)})},this.setMap=function(a){this.mapa=a},this.displayFeatureInfo=function(a,b,c){var d=[];if(map.forEachFeatureAtPixel(a,function(a,b){d.push(a)}),d.length>0){for(var e=[],f=0;f<d.length;++f)e.push(c(d[f]));that.setConteudo(e.join("<hr> ")||"(unknown)")}else that.setConteudo("no Info")}}